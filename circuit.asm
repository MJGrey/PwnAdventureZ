.include "defines.inc"

.segment "FIXED"

PROC in_bit
	txa
	lsr
	lsr
	lsr
	tay
	txa
	and #7
	tax
	lda toggle_mask, x
	and traces, y
	cmp #0
	bne one
	rts
one:
	lda #1
	rts
.endproc

PROC out_bit
	pha
	txa
	lsr
	lsr
	lsr
	tay
	txa
	and #7
	tax
	pla
	cmp #0
	bne one
	lda toggle_mask, x
	eor #$ff
	and traces, y
	sta traces, y
	rts
one:
	lda toggle_mask, x
	ora traces, y
	sta traces, y
	rts
.endproc

PROC and_bit
	pha
	jsr in_bit
	sta temp
	pla
	and temp
	rts
.endproc

PROC or_bit
	pha
	jsr in_bit
	sta temp
	pla
	ora temp
	rts
.endproc

PROC xor_bit
	pha
	jsr in_bit
	sta temp
	pla
	eor temp
	rts
.endproc

PROC check_blocky_state
; Solution is 78c824
	lda blocky_state + 0
	and #$01
	ldx #35
	jsr out_bit
	lda blocky_state + 0
	and #$02
	ldx #45
	jsr out_bit
	lda blocky_state + 0
	and #$04
	ldx #59
	jsr out_bit
	lda blocky_state + 0
	and #$08
	ldx #68
	jsr out_bit
	lda blocky_state + 0
	and #$10
	ldx #79
	jsr out_bit
	lda blocky_state + 0
	and #$20
	ldx #92
	jsr out_bit
	lda blocky_state + 0
	and #$40
	ldx #107
	jsr out_bit
	lda blocky_state + 0
	and #$80
	ldx #116
	jsr out_bit
	lda blocky_state + 1
	and #$01
	ldx #127
	jsr out_bit
	lda blocky_state + 1
	and #$02
	ldx #16
	jsr out_bit
	lda blocky_state + 1
	and #$04
	ldx #20
	jsr out_bit
	lda blocky_state + 1
	and #$08
	ldx #26
	jsr out_bit
	lda blocky_state + 1
	and #$10
	ldx #162
	jsr out_bit
	lda blocky_state + 1
	and #$20
	ldx #165
	jsr out_bit
	lda blocky_state + 1
	and #$40
	ldx #168
	jsr out_bit
	lda blocky_state + 1
	and #$80
	ldx #172
	jsr out_bit
	lda blocky_state + 2
	and #$01
	ldx #176
	jsr out_bit
	lda blocky_state + 2
	and #$02
	ldx #139
	jsr out_bit
	lda blocky_state + 2
	and #$04
	ldx #142
	jsr out_bit
	lda blocky_state + 2
	and #$08
	ldx #146
	jsr out_bit
	lda blocky_state + 2
	and #$10
	ldx #150
	jsr out_bit
	lda blocky_state + 2
	and #$20
	ldx #153
	jsr out_bit
	lda blocky_state + 2
	and #$40
	ldx #156
	jsr out_bit
	lda blocky_state + 2
	and #$80
	ldx #159
	jsr out_bit
	lda #1
	ldx #17
	jsr out_bit
	lda #1
	ldx #21
	jsr out_bit
	lda #1
	ldx #27
	jsr out_bit
	lda #0
	ldx #36
	jsr out_bit
	lda #1
	ldx #46
	jsr out_bit
	lda #1
	ldx #60
	jsr out_bit
	lda #0
	ldx #69
	jsr out_bit
	lda #0
	ldx #80
	jsr out_bit
	lda #1
	ldx #93
	jsr out_bit
	lda #1
	ldx #108
	jsr out_bit
	lda #0
	ldx #117
	jsr out_bit
	lda #0
	ldx #128
	jsr out_bit
	lda #1
	ldx #140
	jsr out_bit
	lda #0
	ldx #143
	jsr out_bit
	lda #0
	ldx #147
	jsr out_bit
	lda #0
	ldx #151
	jsr out_bit
	lda #1
	ldx #154
	jsr out_bit
	lda #1
	ldx #157
	jsr out_bit
	lda #0
	ldx #160
	jsr out_bit
	lda #0
	ldx #163
	jsr out_bit
	lda #0
	ldx #166
	jsr out_bit
	lda #1
	ldx #169
	jsr out_bit
	lda #0
	ldx #173
	jsr out_bit
	lda #1
	ldx #177
	jsr out_bit
	ldx #16
	jsr in_bit
	eor #1
	ldx #15
	jsr out_bit
	ldx #15
	jsr in_bit
	ldx #17
	jsr xor_bit
	ldx #14
	jsr out_bit
	ldx #20
	jsr in_bit
	ldx #21
	jsr xor_bit
	ldx #19
	jsr out_bit
	ldx #15
	jsr in_bit
	ldx #17
	jsr and_bit
	ldx #22
	jsr out_bit
	ldx #19
	jsr in_bit
	ldx #22
	jsr xor_bit
	ldx #18
	jsr out_bit
	ldx #26
	jsr in_bit
	eor #1
	ldx #25
	jsr out_bit
	ldx #25
	jsr in_bit
	ldx #27
	jsr xor_bit
	ldx #24
	jsr out_bit
	ldx #20
	jsr in_bit
	ldx #21
	jsr and_bit
	ldx #29
	jsr out_bit
	ldx #20
	jsr in_bit
	ldx #21
	jsr or_bit
	ldx #31
	jsr out_bit
	ldx #15
	jsr in_bit
	ldx #17
	jsr and_bit
	ldx #31
	jsr and_bit
	ldx #30
	jsr out_bit
	ldx #29
	jsr in_bit
	ldx #30
	jsr or_bit
	ldx #28
	jsr out_bit
	ldx #24
	jsr in_bit
	ldx #28
	jsr xor_bit
	ldx #23
	jsr out_bit
	ldx #14
	jsr in_bit
	ldx #18
	jsr or_bit
	ldx #23
	jsr or_bit
	ldx #13
	jsr out_bit
	ldx #35
	jsr in_bit
	eor #1
	ldx #34
	jsr out_bit
	ldx #34
	jsr in_bit
	ldx #36
	jsr xor_bit
	ldx #33
	jsr out_bit
	ldx #25
	jsr in_bit
	ldx #27
	jsr and_bit
	ldx #38
	jsr out_bit
	ldx #25
	jsr in_bit
	ldx #27
	jsr or_bit
	ldx #40
	jsr out_bit
	ldx #20
	jsr in_bit
	ldx #21
	jsr and_bit
	ldx #40
	jsr and_bit
	ldx #39
	jsr out_bit
	ldx #15
	jsr in_bit
	ldx #17
	jsr and_bit
	ldx #31
	jsr and_bit
	ldx #42
	jsr out_bit
	ldx #42
	jsr in_bit
	ldx #40
	jsr and_bit
	ldx #41
	jsr out_bit
	ldx #38
	jsr in_bit
	ldx #39
	jsr or_bit
	ldx #41
	jsr or_bit
	ldx #37
	jsr out_bit
	ldx #33
	jsr in_bit
	ldx #37
	jsr xor_bit
	ldx #32
	jsr out_bit
	ldx #45
	jsr in_bit
	ldx #46
	jsr xor_bit
	ldx #44
	jsr out_bit
	ldx #34
	jsr in_bit
	ldx #36
	jsr and_bit
	ldx #49
	jsr out_bit
	ldx #34
	jsr in_bit
	ldx #36
	jsr or_bit
	ldx #51
	jsr out_bit
	ldx #25
	jsr in_bit
	ldx #27
	jsr and_bit
	ldx #51
	jsr and_bit
	ldx #50
	jsr out_bit
	ldx #40
	jsr in_bit
	ldx #51
	jsr and_bit
	ldx #53
	jsr out_bit
	ldx #20
	jsr in_bit
	ldx #21
	jsr and_bit
	ldx #53
	jsr and_bit
	ldx #52
	jsr out_bit
	ldx #49
	jsr in_bit
	ldx #50
	jsr or_bit
	ldx #52
	jsr or_bit
	ldx #48
	jsr out_bit
	ldx #31
	jsr in_bit
	ldx #53
	jsr and_bit
	ldx #55
	jsr out_bit
	ldx #15
	jsr in_bit
	ldx #17
	jsr and_bit
	ldx #55
	jsr and_bit
	ldx #54
	jsr out_bit
	ldx #48
	jsr in_bit
	ldx #54
	jsr or_bit
	ldx #47
	jsr out_bit
	ldx #44
	jsr in_bit
	ldx #47
	jsr xor_bit
	ldx #43
	jsr out_bit
	ldx #13
	jsr in_bit
	ldx #32
	jsr or_bit
	ldx #43
	jsr or_bit
	ldx #12
	jsr out_bit
	ldx #59
	jsr in_bit
	eor #1
	ldx #58
	jsr out_bit
	ldx #58
	jsr in_bit
	ldx #60
	jsr xor_bit
	ldx #57
	jsr out_bit
	ldx #45
	jsr in_bit
	ldx #46
	jsr and_bit
	ldx #62
	jsr out_bit
	ldx #45
	jsr in_bit
	ldx #46
	jsr or_bit
	ldx #64
	jsr out_bit
	ldx #64
	jsr in_bit
	ldx #47
	jsr and_bit
	ldx #63
	jsr out_bit
	ldx #62
	jsr in_bit
	ldx #63
	jsr or_bit
	ldx #61
	jsr out_bit
	ldx #57
	jsr in_bit
	ldx #61
	jsr xor_bit
	ldx #56
	jsr out_bit
	ldx #68
	jsr in_bit
	eor #1
	ldx #67
	jsr out_bit
	ldx #67
	jsr in_bit
	ldx #69
	jsr xor_bit
	ldx #66
	jsr out_bit
	ldx #58
	jsr in_bit
	ldx #60
	jsr and_bit
	ldx #71
	jsr out_bit
	ldx #58
	jsr in_bit
	ldx #60
	jsr or_bit
	ldx #73
	jsr out_bit
	ldx #45
	jsr in_bit
	ldx #46
	jsr and_bit
	ldx #73
	jsr and_bit
	ldx #72
	jsr out_bit
	ldx #64
	jsr in_bit
	ldx #73
	jsr and_bit
	ldx #75
	jsr out_bit
	ldx #47
	jsr in_bit
	ldx #75
	jsr and_bit
	ldx #74
	jsr out_bit
	ldx #71
	jsr in_bit
	ldx #72
	jsr or_bit
	ldx #74
	jsr or_bit
	ldx #70
	jsr out_bit
	ldx #66
	jsr in_bit
	ldx #70
	jsr xor_bit
	ldx #65
	jsr out_bit
	ldx #12
	jsr in_bit
	ldx #56
	jsr or_bit
	ldx #65
	jsr or_bit
	ldx #11
	jsr out_bit
	ldx #79
	jsr in_bit
	eor #1
	ldx #78
	jsr out_bit
	ldx #78
	jsr in_bit
	ldx #80
	jsr xor_bit
	ldx #77
	jsr out_bit
	ldx #67
	jsr in_bit
	ldx #69
	jsr and_bit
	ldx #83
	jsr out_bit
	ldx #67
	jsr in_bit
	ldx #69
	jsr or_bit
	ldx #85
	jsr out_bit
	ldx #58
	jsr in_bit
	ldx #60
	jsr and_bit
	ldx #85
	jsr and_bit
	ldx #84
	jsr out_bit
	ldx #45
	jsr in_bit
	ldx #46
	jsr and_bit
	ldx #73
	jsr and_bit
	ldx #87
	jsr out_bit
	ldx #87
	jsr in_bit
	ldx #85
	jsr and_bit
	ldx #86
	jsr out_bit
	ldx #83
	jsr in_bit
	ldx #84
	jsr or_bit
	ldx #86
	jsr or_bit
	ldx #82
	jsr out_bit
	ldx #47
	jsr in_bit
	ldx #75
	jsr and_bit
	ldx #85
	jsr and_bit
	ldx #88
	jsr out_bit
	ldx #82
	jsr in_bit
	ldx #88
	jsr or_bit
	ldx #81
	jsr out_bit
	ldx #77
	jsr in_bit
	ldx #81
	jsr xor_bit
	ldx #76
	jsr out_bit
	ldx #92
	jsr in_bit
	eor #1
	ldx #91
	jsr out_bit
	ldx #91
	jsr in_bit
	ldx #93
	jsr xor_bit
	ldx #90
	jsr out_bit
	ldx #78
	jsr in_bit
	ldx #80
	jsr and_bit
	ldx #96
	jsr out_bit
	ldx #78
	jsr in_bit
	ldx #80
	jsr or_bit
	ldx #98
	jsr out_bit
	ldx #67
	jsr in_bit
	ldx #69
	jsr and_bit
	ldx #98
	jsr and_bit
	ldx #97
	jsr out_bit
	ldx #85
	jsr in_bit
	ldx #98
	jsr and_bit
	ldx #100
	jsr out_bit
	ldx #58
	jsr in_bit
	ldx #60
	jsr and_bit
	ldx #100
	jsr and_bit
	ldx #99
	jsr out_bit
	ldx #96
	jsr in_bit
	ldx #97
	jsr or_bit
	ldx #99
	jsr or_bit
	ldx #95
	jsr out_bit
	ldx #73
	jsr in_bit
	ldx #100
	jsr and_bit
	ldx #102
	jsr out_bit
	ldx #45
	jsr in_bit
	ldx #46
	jsr and_bit
	ldx #102
	jsr and_bit
	ldx #101
	jsr out_bit
	ldx #64
	jsr in_bit
	ldx #102
	jsr and_bit
	ldx #104
	jsr out_bit
	ldx #47
	jsr in_bit
	ldx #104
	jsr and_bit
	ldx #103
	jsr out_bit
	ldx #95
	jsr in_bit
	ldx #101
	jsr or_bit
	ldx #103
	jsr or_bit
	ldx #94
	jsr out_bit
	ldx #90
	jsr in_bit
	ldx #94
	jsr xor_bit
	ldx #89
	jsr out_bit
	ldx #11
	jsr in_bit
	ldx #76
	jsr or_bit
	ldx #89
	jsr or_bit
	ldx #10
	jsr out_bit
	ldx #107
	jsr in_bit
	ldx #108
	jsr xor_bit
	ldx #106
	jsr out_bit
	ldx #91
	jsr in_bit
	ldx #93
	jsr and_bit
	ldx #110
	jsr out_bit
	ldx #91
	jsr in_bit
	ldx #93
	jsr or_bit
	ldx #112
	jsr out_bit
	ldx #112
	jsr in_bit
	ldx #94
	jsr and_bit
	ldx #111
	jsr out_bit
	ldx #110
	jsr in_bit
	ldx #111
	jsr or_bit
	ldx #109
	jsr out_bit
	ldx #106
	jsr in_bit
	ldx #109
	jsr xor_bit
	ldx #105
	jsr out_bit
	ldx #116
	jsr in_bit
	eor #1
	ldx #115
	jsr out_bit
	ldx #115
	jsr in_bit
	ldx #117
	jsr xor_bit
	ldx #114
	jsr out_bit
	ldx #107
	jsr in_bit
	ldx #108
	jsr and_bit
	ldx #119
	jsr out_bit
	ldx #107
	jsr in_bit
	ldx #108
	jsr or_bit
	ldx #121
	jsr out_bit
	ldx #91
	jsr in_bit
	ldx #93
	jsr and_bit
	ldx #121
	jsr and_bit
	ldx #120
	jsr out_bit
	ldx #112
	jsr in_bit
	ldx #121
	jsr and_bit
	ldx #123
	jsr out_bit
	ldx #94
	jsr in_bit
	ldx #123
	jsr and_bit
	ldx #122
	jsr out_bit
	ldx #119
	jsr in_bit
	ldx #120
	jsr or_bit
	ldx #122
	jsr or_bit
	ldx #118
	jsr out_bit
	ldx #114
	jsr in_bit
	ldx #118
	jsr xor_bit
	ldx #113
	jsr out_bit
	ldx #10
	jsr in_bit
	ldx #105
	jsr or_bit
	ldx #113
	jsr or_bit
	ldx #9
	jsr out_bit
	ldx #127
	jsr in_bit
	eor #1
	ldx #126
	jsr out_bit
	ldx #126
	jsr in_bit
	ldx #128
	jsr xor_bit
	ldx #125
	jsr out_bit
	ldx #115
	jsr in_bit
	ldx #117
	jsr and_bit
	ldx #131
	jsr out_bit
	ldx #115
	jsr in_bit
	ldx #117
	jsr or_bit
	ldx #133
	jsr out_bit
	ldx #107
	jsr in_bit
	ldx #108
	jsr and_bit
	ldx #133
	jsr and_bit
	ldx #132
	jsr out_bit
	ldx #91
	jsr in_bit
	ldx #93
	jsr and_bit
	ldx #121
	jsr and_bit
	ldx #135
	jsr out_bit
	ldx #135
	jsr in_bit
	ldx #133
	jsr and_bit
	ldx #134
	jsr out_bit
	ldx #131
	jsr in_bit
	ldx #132
	jsr or_bit
	ldx #134
	jsr or_bit
	ldx #130
	jsr out_bit
	ldx #94
	jsr in_bit
	ldx #123
	jsr and_bit
	ldx #133
	jsr and_bit
	ldx #136
	jsr out_bit
	ldx #130
	jsr in_bit
	ldx #136
	jsr or_bit
	ldx #129
	jsr out_bit
	ldx #125
	jsr in_bit
	ldx #129
	jsr xor_bit
	ldx #124
	jsr out_bit
	ldx #139
	jsr in_bit
	eor #1
	ldx #138
	jsr out_bit
	ldx #138
	jsr in_bit
	ldx #140
	jsr xor_bit
	ldx #137
	jsr out_bit
	ldx #9
	jsr in_bit
	ldx #124
	jsr or_bit
	ldx #137
	jsr or_bit
	ldx #8
	jsr out_bit
	ldx #142
	jsr in_bit
	ldx #143
	jsr xor_bit
	ldx #141
	jsr out_bit
	ldx #146
	jsr in_bit
	eor #1
	ldx #145
	jsr out_bit
	ldx #145
	jsr in_bit
	ldx #147
	jsr xor_bit
	ldx #144
	jsr out_bit
	ldx #8
	jsr in_bit
	ldx #141
	jsr or_bit
	ldx #144
	jsr or_bit
	ldx #7
	jsr out_bit
	ldx #150
	jsr in_bit
	eor #1
	ldx #149
	jsr out_bit
	ldx #149
	jsr in_bit
	ldx #151
	jsr xor_bit
	ldx #148
	jsr out_bit
	ldx #153
	jsr in_bit
	ldx #154
	jsr xor_bit
	ldx #152
	jsr out_bit
	ldx #7
	jsr in_bit
	ldx #148
	jsr or_bit
	ldx #152
	jsr or_bit
	ldx #6
	jsr out_bit
	ldx #156
	jsr in_bit
	ldx #157
	jsr xor_bit
	ldx #155
	jsr out_bit
	ldx #159
	jsr in_bit
	ldx #160
	jsr xor_bit
	ldx #158
	jsr out_bit
	ldx #6
	jsr in_bit
	ldx #155
	jsr or_bit
	ldx #158
	jsr or_bit
	ldx #5
	jsr out_bit
	ldx #162
	jsr in_bit
	ldx #163
	jsr xor_bit
	ldx #161
	jsr out_bit
	ldx #165
	jsr in_bit
	ldx #166
	jsr xor_bit
	ldx #164
	jsr out_bit
	ldx #5
	jsr in_bit
	ldx #161
	jsr or_bit
	ldx #164
	jsr or_bit
	ldx #4
	jsr out_bit
	ldx #168
	jsr in_bit
	ldx #169
	jsr xor_bit
	ldx #167
	jsr out_bit
	ldx #172
	jsr in_bit
	eor #1
	ldx #171
	jsr out_bit
	ldx #171
	jsr in_bit
	ldx #173
	jsr xor_bit
	ldx #170
	jsr out_bit
	ldx #4
	jsr in_bit
	ldx #167
	jsr or_bit
	ldx #170
	jsr or_bit
	ldx #3
	jsr out_bit
	ldx #176
	jsr in_bit
	eor #1
	ldx #175
	jsr out_bit
	ldx #175
	jsr in_bit
	ldx #177
	jsr xor_bit
	ldx #174
	jsr out_bit
	ldx #3
	jsr in_bit
	ldx #174
	jsr or_bit
	ldx #2
	jsr out_bit
	ldx #2
	jsr in_bit
	eor #1
	ldx #1
	jsr out_bit
	ldx #1
	jsr in_bit
	ldx #0
	jsr out_bit
	ldx #0
	jsr in_bit
	rts
.endproc
